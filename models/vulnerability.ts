// Vulnerability scanning data models

export interface GitHubRepository {
  id: string;
  name: string;
  fullName: string; // owner/repo
  stars: number;
  language: string | null;
  url: string;
  description: string | null;
  keywords: string[];
  createdAt: string;
  updatedAt: string;
  cloneUrl: string;
}

export interface CodeQLVulnerability {
  id: string;
  ruleId: string;
  message: string;
  severity: 'error' | 'warning' | 'note';
  filePath: string;
  startLine: number;
  endLine: number;
  codeSnippet: string;
  queryName: string;
  cwe?: string;
}

export interface CodeQLDetailedReport {
  databaseInfo: {
    language: string;
    sourceLocation: string;
    databaseVersion: string;
    creationMetadata?: any;
  };
  statistics: {
    totalFiles: number;
    totalLinesOfCode: number;
    totalLinesOfUserCode: number;
    extractedFiles: string[];
  };
  queryResults: {
    totalQueries: number;
    queriesExecuted: string[];
    resultsByQuery: Record<string, number>;
  };
  sarifResults: {
    totalResults: number;
    resultsBySeverity: {
      error: number;
      warning: number;
      note: number;
    };
  };
  codeFlows?: Array<{ // AST traversal paths for vulnerabilities
    ruleId: string;
    message: string;
    flows: Array<{
      threadFlows: Array<{
        locations: Array<{
          file: string;
          line: number;
          column: number;
          message: string;
          kind?: string; // AST node kind
        }>;
      }>;
    }>;
  }>;
  rawSarif?: any; // Full SARIF data (contains complete AST information)
}

export interface VulnerabilityReport {
  id: string;
  repository: GitHubRepository;
  vulnerabilities: CodeQLVulnerability[];
  severity_score: number; // 1-10
  severity_level: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW' | 'INFO';
  summary: string;
  tags: string[];
  references: string[];
  scanTimestamp: string;
  codeqlVersion?: string;
  detailedReport?: CodeQLDetailedReport; // Optional detailed CodeQL report
}
